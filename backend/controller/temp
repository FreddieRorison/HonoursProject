const id = req.body?.jwt.split(";")[0]
    const userPlantId = req.body.userPlantId;
    const deviceId = req.body.deviceId;

    if (!userPlantId || !deviceId) {
        res.status(400).send("Missing Form Data;");
        return;
    }

    const user = await new Promise((resolve, reject) => {
        getUser(id, (err ,result) => {
            if (err) return reject(err);
            resolve(result);
        })
    })

    const device = await new Promise((resolve, reject) => {
        deviceModel.getDeviceByPlantId(userPlantId, (err ,result) => {
            if (err) return reject(err);
            resolve(result);
        })
    })

    if (!device && deviceId !== "none") {
        res.status(400).send({error: "Device not found;"})
        return;
    }

    if (user.Id !== device.UserId && deviceId !== "none") {
        res.status(403).send({error: "User does not own device;"});
        return;
    }

    if (device) {
        deviceModel.edituserPlantId(null, device.Id)
    }
    
    if (deviceId !== "none") {
        deviceModel.edituserPlantId(userPlantId, deviceId)
    }